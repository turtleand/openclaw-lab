---
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const topics = await getCollection('topics');
  return topics.map((topic) => ({
    params: { slug: topic.slug },
    props: { topic },
  }));
}

const { topic } = Astro.props;
const { Content } = await topic.render();

function getStatusBadge(status: string) {
  switch (status) {
    case 'done': return { label: 'Complete', class: 'bg-accent/10 text-accent border-accent/20' };
    case 'in-progress': return { label: 'In Progress', class: 'bg-accent-2/10 text-accent-2 border-accent-2/20' };
    default: return { label: 'Planned', class: 'bg-muted/10 text-muted border-muted/20' };
  }
}

const status = getStatusBadge(topic.data.status);
---

<BaseLayout title={topic.data.title} description={topic.data.summary}>
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "TechArticle",
    "headline": topic.data.title,
    "description": topic.data.summary,
    "author": { "@type": "Person", "name": "Turtleand", "url": "https://turtleand.com" },
    "url": `https://openclaw.turtleand.com/topics/${topic.slug}`
  })} />
  <article class="py-12">
    <div class="container">
      <!-- Back link -->
      <a href="/" class="inline-flex items-center gap-2 text-sm text-muted hover:text-ink no-underline mb-8 transition-colors">
        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        Back to topics
      </a>

      <!-- Header card -->
      <div class="card mb-8">
        <div class="flex flex-wrap items-center gap-3 mb-4">
          <span class="module-badge">{topic.data.module}</span>
          <span class={`px-2.5 py-1 rounded-pill text-xs font-medium border ${status.class}`}>
            {status.label}
          </span>
        </div>
        <h1 class="text-3xl md:text-4xl font-bold mb-3">{topic.data.title}</h1>
        <p class="text-lg text-muted">{topic.data.summary}</p>
      </div>

      <!-- Content -->
      <div class="card">
        <div class="prose max-w-none">
          <Content />
        </div>
      </div>
    </div>
  </article>
</BaseLayout>
